<link rel="import" href="bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="bower_components/firebase-element/firebase-document.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="bower_components/paper-input/all-imports.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/iron-input/iron-input.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="contact-card.html">
<dom-module id="fire-chat">
  <style>
    #panel-right{
      background: #5C6BC0;
    }
    #text {
      @apply(--layout-flex);
      @apply(--layout-center);

    }
    #container-chat{
      @apply(--layout-vertical);
      @apply(--layout-fit);
    }
    #list {
      @apply(--layout-flex);
      overflow: scroll;
      overflow-x: hidden;
    }
    #enviar{
      @apply(--layout-horizontal);
      @apply(--layout-end);
      margin: 5px 10px;
    }
  </style>
  <template>
    <firebase-collection
      id="firedate"
      limit-to-last="15"
      location="https://luminous-torch-7317.firebaseio.com/"
      data="{{mensajes}}">
    </firebase-collection>
    <paper-drawer-panel>
      <paper-header-panel drawer>
        <paper-toolbar>
          <div>Application</div>
        </paper-toolbar>
        <div> Drawer content... </div>
      </paper-header-panel>
      <paper-header-panel main>
        <paper-toolbar id="panel-right">
          <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
          <div>Title</div>
        </paper-toolbar>
          <section  id="container-chat">
            <div id="list">
                <template is="dom-repeat" items="[[mensajes]]" as="chats">
                  <contact-card>
                    <img src=[[chats.avatar]] alt=[[chats.name]]>
                    <span>
                    <h3>[[chats.name]]</h3>
                    <p>[[chats.text]]</p>
                    </span>
                  </contact-card>
                </template>
            </div>
            <div id="enviar">
              <paper-textarea id="text"   value="{{mensaje::input}}" label="Mensaje"></paper-textarea>
              <paper-fab icon="send" on-click="send"></paper-fab>
            </div>
        </section>
      </paper-header-panel>
    </paper-drawer-panel>
  </template>
  <script>
  Polymer({
    is: "fire-chat",
    properties: {
      mensaje: {
        type: String,
        value: ''
      },
      name: {
        type: String,
        value: ''
      },
      avatar: {
        type: String,
        value: ''
      }
    },
    getCookie: function (cname) {
      var name = cname + "=";
      var ca = document.cookie.split(';');
      for(var i=0; i<ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1);
          if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
      }
      return "";
      },
    send: function(e) {
        this.name = this.getCookie("name");
        this.avatar = this.getCookie("avatar");
        this.$.firedate.add({avatar:this.avatar, name:this.name, text:this.mensaje});
        this.$.text.value='';
    }
  });
</script>
</dom-module>